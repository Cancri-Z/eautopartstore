<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results</title>
    <link rel="stylesheet" href="/css_folder/search-results.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <header>
        <div class="top">
          <div class="logo">
            <a href="/">
              <img src="/public/icon_images/Logo_2.png" alt="eas logo">
            </a>
          </div>
          <div class="others">
            <a href="/sell" title="sell on e-autopartstore" id="soeas"><i class="fa-solid fa-store"></i><span>SELL</span</a>
            <a href="my-ads" id="my-ads">+</a>
            <a href="/profile" title="Account"><i class="fa-solid fa-user"></i></a>
           
          <div class="toggle-bar" onclick="toggleDropdown()">
            <i class="fa-solid fa-bars" id="toggleButton"></i>
            <ul id="list" class="hidden">
                  <li id="hide1"><i class="fa-solid fa-xmark"></i></li>
                  <li><a href="/profile">Profile</a></li>
                  <li>
                      <div id="brands">Brands</div>
                          <div id="brdhide">
                              <div id="cnl"> <i class="fa-solid fa-xmark"></i></div>
                              <a href="brands/acura">Acura</a>
                              <a href="brands/audi">audi</a>
                              <a href="brands/bmw">bmw</a>
                              <a href="brands/cheverolet">chevrolet</a>
                              <a href="brands/ford">ford</a>
                              <a href="brands/honda">honda</a>
                              <a href="brands/hyundai">hyundai</a>
                              <a href="brands/landrover">landrover</a>
                              <a href="brands/lexus">lexus</a>
                              <a href="brands/mercedes">mercedes_Benz</a>
                              <a href="brands/mitsubishi">mitsubishi</a>
                              <a href="brands/nissan">nissan</a>
                              <a href="brands/peugeot">peugeot</a>
                              <a href="brands/renault">renault</a>
                              <a href="brands/suzuki">suzuki</a>
                              <a href="brands/toyota">Toyota</a>
                              <a href="brands/volkswagen">volkswagen</a>
                              <a href="brands/volvo">volvo</a>
                          </div>
                  </li>
                  <li>
                            <i class="fa-solid fa-bell"></i>
                            <span><a href="">Notification</a></span>
                  </li>
                  <li><a href="">Help & support</a></li>
                  <li><a href="">Contact Us</a></li>
                  <li><a href="/logout">Logout</a></li>
            </ul>
          </div>
            
          </div>
        </div>
        <div class="bottom">
          <div class="search">
              <input type="text" id="searchInput" class="search input" placeholder="Search for products, categories and offers..." autocomplete="off">
              <button onclick="searchProducts()">
                <span><i class="fa-solid fa-magnifying-glass"></i></span>
              </button>
          </div>
        </div>
          
        </div>
      </header>



<main>
    <h1 id="res">Search Results for "<%= searchTerm %>"</h1>
    <div class="searchResults">
        <% mainResults.forEach(product => { %>
            <a href="/product/<%= product.productId %>" class="product-card">
                <img src="<%= product.photos[0] %>" alt="<%= product.name %>">
                <article>
                    <p><%= product.name %></p>
                   <p class="price"><span class="priceDiv">₦<%= product.price.toLocaleString() %></span></p> 
                </article>
            </a>
        <% }) %>
    </div>
        
    <!-- Related searches -->
    <p id="rel">Related Searches</p>
    <div class="related"></div>
</main>
    
    <script>
        // Function to format a number with commas
            function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }

        async function displaySearchResults() {
            const searchTerm = '<%= searchTerm %>';
            
            try {
                const response = await fetch('/json_folder/products.json');
                const responseData = await response.json();
    
                // Ensure that responseData is an object with a products array
                const products = responseData && responseData.products ? responseData.products : [];
    
                // Filter main search results
                const mainResults = products.filter(product => 
                    product.name.toLowerCase().includes(searchTerm.toLowerCase())
                );
    
                // Display main search results
                const searchResultsContainer = document.querySelector('.searchResults');
                mainResults.forEach(product => {
                    console.log('Product ID:', product.productId);

                    const productCard = document.createElement('a');
                    productCard.href = `/product/${product.productId}`; // Link to product details page
                    productCard.classList.add('pd_cd');
    
                    const productCardContent = document.createElement('div');
                    productCardContent.classList.add('product-card');
    
                    const productImage = document.createElement('img');
                    if (product.photos && product.photos.length > 0) {
                        productImage.src = `/${product.photos[0]}`; // Using the first image from the photo array
                    } else {
                        productImage.src = 'default-image.jpg'; // Fallback image if none exists
                    }
                    productImage.alt = product.name;

    
                    const productDetails = document.createElement('article');
                    const productName = document.createElement('p');
                    productName.textContent = product.name;
    
                    const productPrice = document.createElement('p');
                    productPrice.classList.add('price');
                    productPrice.innerHTML = `<span class="priceDiv">₦${formatNumber(product.price)}</span>`;
    
                    productDetails.appendChild(productName);
                    productDetails.appendChild(productPrice);
    
                    productCardContent.appendChild(productImage);
                    productCardContent.appendChild(productDetails);
    
                    productCard.appendChild(productCardContent);
                    searchResultsContainer.appendChild(productCard);
                });
    
                // Display related searches (sample logic)
                const relatedContainer = document.querySelector('.related');
                const relatedSearches = products.filter(product => 
                    product.name.toLowerCase().includes('related term') // Sample logic for related searches
                );
    
                relatedSearches.forEach(product => {
                    const relatedItem = document.createElement('div');
                    relatedItem.textContent = product.name;
                    relatedContainer.appendChild(relatedItem);
                });
            } catch (error) {
                console.error('Error fetching or parsing products:', error);
            }
        }
    
        displaySearchResults();
    </script>


</body>
</html>
