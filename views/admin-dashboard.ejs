<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="/css_folder/register_page.css">
    <link rel="stylesheet" href="/css_folder/adminpage.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" 
       integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" 
       crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
  <header>
    <div class="top">
      <div class="logo">
        <a href="/">
          <img src="/icon_images/Logo_2.png" alt="eas logo" width="250px" height="37px">
        </a>
      </div>
  </header>

  <main>
    <h1>Admin Dashboard</h1>
    
    <h2>Statistics</h2>
    <p>Approved Products: <%= approvedProducts %></p>
    <p>Denied Products: <%= deniedProducts %></p>
    
    <h2>Pending Products</h2>
    <% pendingProducts.forEach(product => { %>
        <div class="product-details">
            <h3><%= product.name %></h3>
            <p><strong>Category:</strong> <%= product.category %></p>
            <p><strong>Type:</strong> <%= product.type %></p>
            <p><strong>Brand:</strong> <%= product.brand %></p>
            <p><strong>Model:</strong> <%= product.model %></p>
            <p><strong>Year:</strong> <%= product.year %></p>
            <p><strong>Description:</strong> <%= product.description %></p>
            <p><strong>Condition:</strong> <%= product.condition %></p>
            <p><strong>Price:</strong> <%= product.price %></p>
            <p><strong>User:</strong> <%= product.userName %></p>
            <p><strong>Whatsapp:</strong> <%= product.whatsapp %></p>
            <p><strong>Telephone:</strong> <%= product.telephone %></p>
            <p><strong>Location:</strong> <%= product.location %></p>
    
            <h4>Images:</h4>
            <div class="image">
                <% product.photos.forEach(photo => { %>
                    <img src="<%= photo %>" alt="<%= product.name %>" style="width: 200px; height: auto;">
                <% }) %>
            </div>
            <div id="request">
            <form action="/approve-product/<%= product.productId %>" method="POST">
                <button type="submit" class="approve-button" data-product-id="<%= product.productId %>">Approve</button>
            </form>
            <form action="/deny-product/<%= product.productId %>" method="POST">
                <input type="text" name="reason" placeholder="Reason for denial" required>
                <button type="submit" class="deny-button" data-product-id="<%= product.productId %>">Deny</button>
            </form>
        </div>
        </div>
    <% }) %>
    

    
    <h2>Product History</h2>
    <form action="/product-history" method="GET">
        <input type="date" name="startDate">
        <input type="date" name="endDate">
        <button type="submit">Fetch History</button>
    </form>
    

<button id="showHistory">Show Product History</button>

<div id="historyPopup" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:white; padding:20px; border:1px solid black;">
    <h2>Product History</h2>
    <input type="date" id="startDate">
    <input type="date" id="endDate">
    <button id="fetchHistory">Fetch History</button>
    <div id="historyContent"></div>
    <button id="closeHistory">Close</button>
</div>


  </main>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
  $(document).ready(function() {
      $('.approve-button').click(function(e) {
          e.preventDefault();
          const productId = $(this).data('product-id');
          $.post(`/approve-product/${productId}`, function(response) {
              if (response.success) {
                  // Remove the product from the dashboard
                  $(`#product-${productId}`).remove();
                  alert('Product approved successfully');
              } else {
                  alert('Error approving product: ' + response.error);
              }
          }).fail(function() {
              alert('Error: You may need to log in again.');
          });
      });
  
      $('.deny-button').click(function(e) {
          e.preventDefault();
          const productId = $(this).data('product-id');
          const reason = prompt('Please enter a reason for denial:');
          if (reason) {
              $.post(`/deny-product/${productId}`, { denialReason: reason }, function(response) {
                  if (response.success) {
                      // Remove the product from the dashboard
                      $(`#product-${productId}`).remove();
                      alert('Product denied successfully');
                  } else {
                      alert('Error denying product: ' + response.error);
                  }
              }).fail(function() {
                  alert('Error: You may need to log in again.');
              });
          }
      });
  });
  </script>
</body>
</html>

